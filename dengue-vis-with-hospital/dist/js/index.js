"use strict";$(document).ready(function(){function e(e){return new Promise(function(n,t){d3.tsv(e,function(e){e?n(e):t(new Error("get data error"))})})}function n(){return new Promise(function(e,n){navigator.geolocation?navigator.geolocation.watchPosition(function(n){e(n)}):n()})}$("#hintButton").on("click",function(){$("#hint").removeClass("show")});var t=L.map("map").setView([22.99,120.218],13),o="pk.eyJ1IjoiYWJ6NTMzNzgiLCJhIjoiUkRleEgwVSJ9.rWFItANcHAZQ2U0ousK4cA",i="abz53378.0klc153h",c=new Date;L.tileLayer("https://api.tiles.mapbox.com/v4/"+i+"/{z}/{x}/{y}.png?access_token="+o,{maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a><a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/nl/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/nl/80x15.png" /></a>.'}).addTo(t),window.innerWidth<=800?(document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<button id="QA" class="circular primary ui icon button">\n        <i class="help icon"></i>\n    </button>',window.setTimeout(function(){document.getElementById("QA").addEventListener("click",function(){$("#hint").addClass("show")},!1),$("#QA").click()},1e3),window.alert("請開啟定位，才能正常瀏覽此網頁！"),n().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;t.setView([n,o],15),L.marker([n,o]).addTo(t).bindPopup("所在位置").openPopup(),L.circle([n,o],500,{stroke:!1,fillColor:"blue"}).addTo(t)})["catch"](function(){window.alert("此裝置不支援GPS")})):(document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<button id="GPS" class="ui primary button">我的位置</button>',window.setTimeout(function(){document.getElementById("GPS").addEventListener("click",function e(){console.log(123),document.getElementById("GPS").className+=" loading",n().then(function(e){var n=e.coords.latitude,o=e.coords.longitude;return t.setView([n,o],15),L.marker([n,o]).addTo(t).bindPopup("所在位置").openPopup(),L.circle([n,o],500,{stroke:!1,fillColor:"blue"}).addTo(t),{lat:n,lng:o}}).then(function(n){var t=n.lat,o=n.lng,i=document.getElementById("GPS").className;document.getElementById("GPS").innerText=parseInt(100*t)/100+","+parseInt(100*o)/100,document.getElementById("GPS").className=i.replace("loading",""),document.getElementById("GPS").removeEventListener("click",e,!1)})["catch"](function(){window.alert("此裝置不支援GPS")})}),document.getElementsByClassName("leaflet-control-zoom-out")[0].addEventListener("click",function(){t.zoomOut()},!1),document.getElementsByClassName("leaflet-control-zoom-in")[0].addEventListener("click",function(){t.zoomIn()},!1)},1e3));var a=L.icon({iconUrl:"./hospital1.png",iconSize:[32,32]});e("./data/dengue105.csv").then(function(e){console.log(e);var n=0;return e.forEach(function(e){var o=new Date(e["確診日"]),i=432e6;c-o<i&&(n++,L.circle([e["緯度座標"],e["經度座標"]],200,{stroke:!1,fillColor:"red"}).addTo(t))}),n}).then(function(e){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+e+"個確診病例數</div>"})["catch"](function(e){console.error(e)}),e("./data/hospital_combine.tsv").then(function(e){var n=0,o=[];return o=e.map(function(e){return L.marker([e["緯度"],e["經度"]],{icon:a}).addTo(t).bindPopup(e["名稱"]+"<br/>"+e["電話"]+"<br/>"+e["地址"])}),t.on("zoomend",function(){var e=t.getZoom(),n=e-12,i=L.icon({iconUrl:"./hospital1.png",iconSize:[6*n+32,6*n+32]});o.forEach(function(e){return e.setIcon(i)})}),n})});
