"use strict";$(document).ready(function(){function e(e){return new Promise(function(t,n){d3.tsv(e,function(e){e?t(e):n(new Error("get data error"))})})}function t(){return new Promise(function(e,t){navigator.geolocation?navigator.geolocation.watchPosition(function(t){e(t)}):t()})}$("#hintButton").on("click",function(){$("#hint").removeClass("show")});var n=L.map("map").setView([22.99,120.218],13),o="pk.eyJ1IjoiYWJ6NTMzNzgiLCJhIjoiUkRleEgwVSJ9.rWFItANcHAZQ2U0ousK4cA",i="abz53378.0klc153h",c=new Date;L.tileLayer("https://api.tiles.mapbox.com/v4/"+i+"/{z}/{x}/{y}.png?access_token="+o,{maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a><a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/nl/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/nl/80x15.png" /></a>.'}).addTo(n),window.innerWidth<=800?(document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<button id="QA" class="circular primary ui icon button">\n        <i class="help icon"></i>\n    </button>',window.setTimeout(function(){document.getElementById("QA").addEventListener("click",function(){$("#hint").addClass("show")},!1),$("#QA").click()},1e3),window.alert("請開啟定位，才能正常瀏覽此網頁！"),t().then(function(e){var t=e.coords.latitude,o=e.coords.longitude;n.setView([t,o],15),L.marker([t,o]).addTo(n).bindPopup("所在位置").openPopup(),L.circle([t,o],500,{stroke:!1,fillColor:"blue"}).addTo(n)})["catch"](function(){window.alert("此裝置不支援GPS")})):(document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<button id="GPS" class="ui primary button">我的位置</button>',window.setTimeout(function(){document.getElementById("GPS").addEventListener("click",function e(){console.log(123),document.getElementById("GPS").className+=" loading",t().then(function(e){var t=e.coords.latitude,o=e.coords.longitude;return n.setView([t,o],15),L.marker([t,o]).addTo(n).bindPopup("所在位置").openPopup(),L.circle([t,o],500,{stroke:!1,fillColor:"blue"}).addTo(n),{lat:t,lng:o}}).then(function(t){var n=t.lat,o=t.lng,i=document.getElementById("GPS").className;document.getElementById("GPS").innerText=parseInt(100*n)/100+","+parseInt(100*o)/100,document.getElementById("GPS").className=i.replace("loading",""),document.getElementById("GPS").removeEventListener("click",e,!1)})["catch"](function(){window.alert("此裝置不支援GPS")})}),document.getElementsByClassName("leaflet-control-zoom-out")[0].addEventListener("click",function(){n.zoomOut()},!1),document.getElementsByClassName("leaflet-control-zoom-in")[0].addEventListener("click",function(){n.zoomIn()},!1)},1e3));var a=L.icon({iconUrl:"./hospital1.png",iconSize:[64,64]});e("./data/dengue105.csv").then(function(e){var t=0;return e.forEach(function(e){var o=new Date(e["確診日"]),i=432e6;c-o<i&&(t++,L.circle([e["緯度座標"],e["經度座標"]],200,{stroke:!1,fillColor:"red"}).addTo(n))}),t}).then(function(e){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+e+"個確診病例數</div>"})["catch"](function(e){console.error(e)}),e("./data/hospital_combine.tsv").then(function(e){var t=0;return console.log(e),e.forEach(function(e){L.marker([e["緯度"],e["經度"]],{icon:a}).addTo(n).bindPopup(e["名稱"]+"<br/>"+e["電話"]+"<br/>"+e["地址"])}),t})});