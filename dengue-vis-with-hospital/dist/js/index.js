"use strict";function getData(e){return new Promise(function(n,a){d3.csv(e,function(e){e?n(e):a(new Error("get data error"))})})}function urlParse(e,n){n||(n=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",t=new RegExp(a),o=t.exec(n);return null==o?null:o[1]}var lat=urlParse("lat"),lng=urlParse("lng"),map=L.map("map").setView([lat,lng],15),accessToken="pk.eyJ1IjoiYWJ6NTMzNzgiLCJhIjoiUkRleEgwVSJ9.rWFItANcHAZQ2U0ousK4cA",mapID="abz53378.0klc153h",today=new Date;L.tileLayer("https://api.tiles.mapbox.com/v4/"+mapID+"/{z}/{x}/{y}.png?access_token="+accessToken,{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a><a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/nl/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/nl/80x15.png" /></a><br />Image is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/nl/">Creative Commons Attribution-NonCommercial 3.0 Netherlands License</a>.'}).addTo(map),L.marker([lat,lng]).addTo(map).bindPopup("所在位置").openPopup(),L.circle([lat,lng],500,{stroke:!1,fillColor:"blue"}).addTo(map);var myIcon=L.icon({iconUrl:"./hospital1.png",iconSize:[42,42]});getData("./data/dengue105.csv").then(function(e){var n=0;return e.forEach(function(e){var a=new Date(e["確診日"]),t=432e6;today-a<t&&(n++,L.circle([e["緯度座標"],e["經度座標"]],200,{stroke:!1,fillColor:"red"}).addTo(map))}),n}).then(function(e){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+e+"個確診病例數</div>"})["catch"](function(e){console.error(e)}),getData("./data/eggs.csv").then(function(e){var n=0;return e.forEach(function(e){L.marker([e["緯度"],e["經度"]],{icon:myIcon}).addTo(map).bindPopup(e["醫療院所名稱"]+"<br/>"+e["電話"])}),n}).then(function(e){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+e+"個確診病例數</div>"})["catch"](function(e){console.error(e)});