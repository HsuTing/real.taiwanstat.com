!function e(t,o,n){function r(a,c){if(!o[a]){if(!t[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var s=o[a]={exports:{}};t[a][0].call(s.exports,function(e){var o=t[a][1][e];return r(o?o:e)},s,s.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,o){!function(){function t(e,t){var r=e[0].PublishTime;for(var i in e){e[i].PublishTime>=r&&($(".updateAt").text("更新時間："+e[i].PublishTime+"（每小時更新）"),r=e[i].PublishTime);var a,c=n(e[i]["PM2.5"]);a="yellow"==c.color?p:"brown"==c.color?f:L.AwesomeMarkers.icon({prefix:"fa",icon:"map-marker",markerColor:c.color});var l=o(e[i].SiteName,t),d=L.marker([l.TWD97Lat,l.TWD97Lon],{icon:a,opacity:.9}).addTo(s);d.bindPopup("<strong>測站名稱："+e[i].SiteName+'</strong><br/><span class="'+c.color+'">PM2.5 空污指標：'+c.disc+"</span><br/>PM2.5："+e[i]["PM2.5"]+"（μg/m3）<br/>PM10："+e[i].PM10+"（μg/m3）<br/>PSI："+e[i].PSI+"<br/>測站類型："+l.SiteType+"<br/>地址："+l.SiteAddress)}d3Initialize(s,t)}function o(e,t){for(var o in t)if(t[o].SiteName==e)return t[o]}function n(e){return 12>=e?{disc:"空氣品質良好",color:"green"}:35>=e?{disc:"空氣品質普通",color:"yellow"}:55>=e?{disc:"對敏感性族群不健康",color:"orange"}:150>=e?{disc:"空氣品質不良",color:"red"}:250>=e?{disc:"空氣品質非常不良",color:"purple"}:{disc:"空氣品質屬有害",color:"brown"}}function r(){s=new L.Map("map"),url="http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",attrib='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';var e=new L.TileLayer(url,{minZoom:1,maxZoom:16,attribution:attrib});s.setView(new L.LatLng(24,121),7),e.addTo(s),u.addTo(s),g.addTo(s)}function i(){return navigator.geolocation?navigator.geolocation.getCurrentPosition(a):void 0}function a(e){s.setView(new L.LatLng(e.coords.latitude,e.coords.longitude),10)}function c(){s.setView(new L.LatLng(24,121),7)}function l(){d?$(".main-info").hide():$(".main-info").show(),d=!d}d3Initialize=e("./index");var s,d,u=L.control();window.getLocation=i,window.resetView=c,window.toogleInfo=l;var p=L.icon({iconUrl:"./images/yellow.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]}),f=L.icon({iconUrl:"./images/brown.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]});$(document).ready(function(){r(),d3.csv("./data/site.csv",function(e){var o=new Firebase("https://realtaiwanstat2.firebaseio.com");o.child("air").limitToLast(1).on("child_added",function(o){var n=o.val(),r=JSON.parse(n);t(r,e)})})}),u.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this._div.innerHTML='<h4 class="">格狀區塊：表示該區域內最近的測站</h4>',this._div};var g=L.control({position:"bottomright"});g.onAdd=function(e){for(var t=L.DomUtil.create("div","info legend"),o=["#5F2828","#E062C8","#F52305","#F7931C","yellow","#7FB73A"],n=["有害","非常不良","不良","接近不良","普通","良好"],r=0;r<n.length;r++)t.innerHTML+='<i style="background:'+o[r]+'"></i>'+n[r]+"<br/>";return t}}()},{"./index":2}],2:[function(e,t,o){!function(){function e(e,t){c=e,d=t,o(),e.on("viewreset moveend",function(e){e&&"viewreset"==e.type&&d3.select("#overlay").remove(),setTimeout(function(){o()},0)})}function o(){d3.select("#overlay").remove(),l=c.getBounds();{var e=c.latLngToLayerPoint(l.getNorthWest());c.latLngToLayerPoint(l.getSouthEast()),d3.set(),l.pad(.4)}i=d3.geo.mercator().center([122.079531,23.978567]).scale(10200),a=d3.geo.path().projection(i),r=d3.select(c.getPanes().overlayPane).append("svg").attr("id","overlay").attr("class","leaflet-zoom-hide").style("width",c.getSize().x+"px").style("height",c.getSize().y+"px").style("margin-left",e.x+"px").style("margin-top",e.y+"px"),s=r.append("g").attr("transform","translate("+-e.x+","+-e.y+")"),n()}function n(){var e=[];d.forEach(function(t){var o=new L.LatLng(+t.TWD97Lat,+t.TWD97Lon);point=c.latLngToLayerPoint(o),e.push(point)});var t=s.attr("class","points").selectAll("g").data(e).enter().append("g").attr("class","point"),o=d3.geom.voronoi().x(function(e){return e.x}).y(function(e){return e.y});o(e).forEach(function(e){e.point.cell=e});var n=function(e){return e.cell?"M"+e.cell.join("L")+"Z":void o([e]).forEach(function(e){return"M"+e.join("L")+"Z"})};t.append("path").attr("class","point-cell").on("click",u).attr("d",n)}t.exports=e;var r,i,a,c,l,s,d=null,u=function(){d3.selectAll(".selected").classed("selected",!1);var e=d3.select(this),t=e.datum();lastSelectedPoint=t,e.classed("selected",!0)}}()},{}]},{},[1]);