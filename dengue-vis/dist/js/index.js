"use strict";function getData(e){return new Promise(function(e,a){d3.csv("./data/dengue105.csv",function(t){t?e(t):a(new Error("get data error"))})})}function urlParse(e,a){a||(a=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(a);return null==r?null:r[1]}var lat=urlParse("lat"),lng=urlParse("lng"),map=L.map("map").setView([lat,lng],13),accessToken="pk.eyJ1IjoiYWJ6NTMzNzgiLCJhIjoiUkRleEgwVSJ9.rWFItANcHAZQ2U0ousK4cA",mapID="abz53378.0klc153h",today=new Date;L.tileLayer("https://api.tiles.mapbox.com/v4/"+mapID+"/{z}/{x}/{y}.png?access_token="+accessToken,{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'}).addTo(map),L.marker([lat,lng]).addTo(map).bindPopup("所在位置").openPopup(),getData().then(function(e){var a=0;return e.forEach(function(e){var t=new Date(e["確診日"]),n=432e6;today-t<n&&(a++,L.circle([e["緯度座標"],e["經度座標"]],200,{stroke:!1,fillColor:"red"}).addTo(map))}),a}).then(function(e){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+e+"個確診病例數</div>"})["catch"](function(e){console.error(e)});
