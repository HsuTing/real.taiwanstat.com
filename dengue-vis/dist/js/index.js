"use strict";function getGPS(){return new Promise(function(t,e){navigator.geolocation.getCurrentPosition(function(r){r?t([r.coords.latitude,r.coords.longitude]):e(new Error("Can't find GPS"))})})}function getData(t){return new Promise(function(t,e){d3.csv("./data/dengue105.csv",function(r){r?t(r):e(new Error("get data error"))})})}var _slicedToArray=function(){function t(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(u){o=!0,a=u}finally{try{!n&&c["return"]&&c["return"]()}finally{if(o)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),map=L.map("map"),accessToken="pk.eyJ1IjoiYWJ6NTMzNzgiLCJhIjoiUkRleEgwVSJ9.rWFItANcHAZQ2U0ousK4cA",mapID="abz53378.0klc153h",today=new Date;getGPS().then(function(t){var e=_slicedToArray(t,2),r=e[0],n=e[1];map.setView([r,n],13),L.marker([r,n]).addTo(map).bindPopup("所在位置").openPopup()})["catch"](function(t){console.error(t)}),getData().then(function(t){var e=0;return t.forEach(function(t){var r=new Date(t["確診日"]),n=432e6;today-r<n&&(e++,L.circle([t["緯度座標"],t["經度座標"]],200,{stroke:!1,fillColor:"red"}).addTo(map))}),e}).then(function(t){document.getElementsByClassName("leaflet-control-container")[0].innerHTML+='<div id="info">近五日內共有'+t+"個確診病例數</div>"})["catch"](function(t){console.error(t)}),L.tileLayer("https://api.tiles.mapbox.com/v4/"+mapID+"/{z}/{x}/{y}.png?access_token="+accessToken,{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'}).addTo(map);